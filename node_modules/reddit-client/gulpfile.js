const gulp = require('gulp');
const babel = require('gulp-babel');
const sourcemaps = require('gulp-sourcemaps');
const watch = require('gulp-watch');
const plumber = require('gulp-plumber');

const babel_cfg = {
  plugins: ['transform-es2015-modules-commonjs',
            'transform-async-to-generator',
            'transform-class-properties',
            'transform-do-expressions',
            'transform-exponentiation-operator',
            'transform-export-extensions',
            'transform-function-bind',
            'transform-object-rest-spread',
            'transform-strict-mode']
};

gulp.task('build', function() {
  return gulp.src('src/**/*.js')
    .pipe(sourcemaps.init())
    .pipe(babel(babel_cfg))
    .pipe(sourcemaps.write('.'))
    .pipe(gulp.dest('lib'));
})

gulp.task('default', function() {
  return gulp.src('src/**/*.js')
    .pipe(watch('src/**/*.js', { verbose: true, ignoreInitial: false }))
    .pipe(plumber())
    .pipe(sourcemaps.init())
    .pipe(babel(babel_cfg))
    .pipe(sourcemaps.write('.'))
    .pipe(gulp.dest('lib'));
});
